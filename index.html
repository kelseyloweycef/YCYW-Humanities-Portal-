<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YCYW Humanities Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; margin: 0; }
        .mesh-bg { background: linear-gradient(135deg, #4f46e5 0%, #1e293b 100%); position: relative; overflow: hidden; }
        .mesh-circle { position: absolute; top: -20%; right: -10%; width: 300px; height: 300px; background: #6366f1; border-radius: 50%; filter: blur(80px); opacity: 0.4; }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, query, where, updateDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyB5Vp_4Vf_ORr5vtDW9ml0VSzhoMt5dqc0",
          authDomain: "ycyw-humanities-portal.firebaseapp.com",
          projectId: "ycyw-humanities-portal",
          storageBucket: "ycyw-humanities-portal.firebasestorage.app",
          messagingSenderId: "141054228326",
          appId: "1:141054228326:web:13248804cf5e407a163aa7"
        };

        const app = initializeApp(firebaseConfig);
        window.FB = { auth: getAuth(app), db: getFirestore(app), onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword, doc, setDoc, getDoc, collection, onSnapshot, query, where, updateDoc, addDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const StandardsView = ({ activeTab, subTab, isAdmin, userData }) => {
            const [selectedDetail, setSelectedDetail] = useState(null);
            const [message, setMessage] = useState('');
            
            const factions = [
                { name: "Past and Present", icon: "fa-history", color: "text-amber-600", bg: "bg-amber-50" },
                { name: "Our Evolving World", icon: "fa-earth-asia", color: "text-emerald-600", bg: "bg-emerald-50" },
                { name: "Global Citizenship", icon: "fa-users-rays", color: "text-blue-600", bg: "bg-blue-50" },
                { name: "Economics & Business", icon: "fa-chart-pie", color: "text-indigo-600", bg: "bg-indigo-50" }
            ];

            const handleSendToAdmins = async () => {
                if(!message) return;
                await window.FB.addDoc(window.FB.collection(window.FB.db, "messages"), {
                    from: userData.email,
                    fromName: userData.name,
                    content: message,
                    subject: `${activeTab} - ${subTab}`,
                    timestamp: window.FB.serverTimestamp(),
                    readBy: []
                });
                alert("Message sent to all Curriculum Officers (Admins)!");
                setMessage('');
            };

            const isSenior = ['igcse', 'ib', 'a-level', 'dse'].includes(activeTab);

            return (
                <div className="space-y-10 animate-in pb-20">
                    {/* Senior Section: Official Board & SOW */}
                    {isSenior ? (
                        <div className="space-y-8">
                            <section className="bg-white p-10 rounded-[3rem] border-2 border-slate-100 shadow-sm">
                                <h3 className="text-xs font-black text-indigo-500 uppercase tracking-widest mb-4 italic">Official Exam Board Curriculum</h3>
                                <div className="p-6 bg-slate-50 rounded-2xl border border-dashed border-slate-300 text-center">
                                    <p className="text-xs font-bold text-slate-400 uppercase tracking-tighter">Click to access external specification links</p>
                                </div>
                            </section>
                            <section className="bg-white p-10 rounded-[3rem] border shadow-sm">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-sm font-black text-slate-800 uppercase tracking-tight">Schemes of Work</h3>
                                    <button className="bg-indigo-600 text-white px-6 py-2 rounded-xl text-[10px] font-black uppercase">Upload SOW</button>
                                </div>
                                <p className="text-xs text-slate-400 font-medium italic">Share your current schemes of work with the global network here.</p>
                            </section>
                        </div>
                    ) : (
                        /* Junior Section: Goals & Factions */
                        <>
                            <section className="bg-white p-10 rounded-[3rem] border shadow-sm">
                                <h3 className="text-[10px] font-black text-indigo-500 uppercase tracking-[0.3em] mb-6">End of Year Goals</h3>
                                <ul className="space-y-3 text-sm font-semibold text-slate-700 list-disc pl-5">
                                    <li>Analyze the intersection of local heritage and global historical shifts.</li>
                                    <li>Develop spatial awareness through thematic mapping projects.</li>
                                    <li>Demonstrate understanding of sustainable resource management.</li>
                                </ul>
                            </section>

                            <div className="space-y-6">
                                {factions.map(f => (
                                    <div key={f.name} className="bg-white p-10 rounded-[3rem] border border-slate-100 flex gap-8 items-center group transition-all">
                                        <div className={`${f.bg} ${f.color} w-20 h-20 rounded-full flex items-center justify-center text-3xl shrink-0 shadow-inner transition-transform group-hover:scale-110`}>
                                            <i className={`fa-solid ${f.icon}`}></i>
                                        </div>
                                        <div className="flex-1">
                                            <h5 className="text-xl font-black text-slate-800 mb-1">{f.name}</h5>
                                            <p className="text-xs text-slate-400 font-bold uppercase tracking-widest mb-3">Curriculum Strand Standard</p>
                                            <p className="text-sm text-slate-500 font-medium">Network alignment for {subTab} focus areas and thematic integration.</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </>
                    )}

                    {/* Global Ask a Question Box */}
                    <section className="bg-indigo-900 p-10 rounded-[3rem] text-white shadow-2xl relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-8 text-7xl opacity-10"><i className="fa-solid fa-paper-plane"></i></div>
                        <h4 className="text-xs font-black uppercase tracking-widest text-indigo-400 mb-4">Ask the Curriculum Officer</h4>
                        <p className="text-sm text-indigo-100 mb-6 max-w-md">Your question will be sent to all system administrators. You will receive a notification when they reply.</p>
                        <textarea value={message} onChange={e => setMessage(e.target.value)} 
                            className="w-full bg-slate-800 p-6 rounded-2xl border-none text-sm text-white placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 mb-4" 
                            placeholder="Type your question or feedback here..." />
                        <button onClick={handleSendToAdmins} className="px-10 py-4 bg-white text-indigo-900 rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-indigo-50 transition-all">Send Message</button>
                    </section>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [userData, setUserData] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [subTab, setSubTab] = useState(null);
            const [viewMode, setViewMode] = useState('standards');
            const [unreadCount, setUnreadCount] = useState(0);
            const [isSubscribed, setIsSubscribed] = useState(false);

            useEffect(() => {
                const unsub = window.FB.onAuthStateChanged(window.FB.auth, async (u) => {
                    if (u) {
                        const d = await window.FB.getDoc(window.FB.doc(window.FB.db, "users", u.uid));
                        if (d.exists()) { setUserData(d.data()); setUser(u); }
                    } else { setUser(null); setUserData(null); }
                });
                return () => unsub();
            }, []);

            // Notification Listener logic
            useEffect(() => {
                if(userData) {
                   // Mock unread count - in production this listens to the 'messages' collection
                   setUnreadCount(2); 
                }
            }, [userData]);

            return (
                <div className="flex h-screen bg-slate-50 overflow-hidden">
                    {/* Sidebar */}
                    <div className="w-64 bg-[#0f172a] text-white flex flex-col h-screen shrink-0 shadow-2xl overflow-y-auto">
                        <div className="p-8 font-black text-[11px] uppercase text-indigo-400 tracking-tighter">YCYW Humanities</div>
                        {/* Navigation Items (Kept from previous) */}
                        <nav className="flex-1 px-4 space-y-1">
                             <button onClick={() => {setActiveTab('dashboard'); setSubTab(null);}} className="w-full text-left p-4 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:bg-slate-800">Dashboard</button>
                             {/* Add other nav categories here as per previous logic */}
                        </nav>
                    </div>

                    <div className="flex-1 flex flex-col overflow-hidden">
                        <header className="h-24 bg-white border-b flex items-center px-10 justify-between shrink-0 shadow-sm">
                            <div className="flex items-center gap-4">
                                <div>
                                    <h2 className="font-black text-slate-800 uppercase text-lg leading-none">{subTab || activeTab}</h2>
                                    {subTab && (
                                        <button onClick={() => setIsSubscribed(!isSubscribed)} className={`mt-2 flex items-center gap-2 text-[8px] font-black uppercase tracking-widest ${isSubscribed ? 'text-emerald-500' : 'text-slate-400'}`}>
                                            <i className={`fa-solid ${isSubscribed ? 'fa-bell' : 'fa-bell-slash'}`}></i>
                                            {isSubscribed ? 'Notifications On' : 'Receive Notifications'}
                                        </button>
                                    )}
                                </div>
                            </div>

                            <div className="flex items-center gap-6">
                                {/* GLOBAL INBOX */}
                                <button className="relative p-3 bg-slate-100 rounded-2xl hover:bg-indigo-50 transition-all group">
                                    <i className="fa-solid fa-inbox text-slate-500 group-hover:text-indigo-600"></i>
                                    {unreadCount > 0 && (
                                        <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[8px] font-black flex items-center justify-center rounded-full border-2 border-white">{unreadCount}</span>
                                    )}
                                </button>

                                <div className="flex items-center gap-3 border-l pl-6">
                                    <div className="text-right">
                                        <p className="text-[10px] font-black text-slate-800 uppercase leading-none">{userData?.name}</p>
                                        <p className="text-[8px] font-bold text-indigo-500 uppercase mt-1">{userData?.role}</p>
                                    </div>
                                    <div className="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-black text-xs uppercase shadow-lg shadow-indigo-200">{userData?.name?.[0]}</div>
                                </div>
                            </div>
                        </header>

                        <main className="flex-1 overflow-y-auto p-10 bg-[#f8fafc]">
                            {subTab ? (
                                <div className="space-y-6 animate-in">
                                    <div className="flex gap-2 mb-10">
                                        <button onClick={() => setViewMode('standards')} className={`px-8 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${viewMode === 'standards' ? 'bg-indigo-600 text-white shadow-xl' : 'bg-white text-slate-400 border'}`}>Curriculum Standards</button>
                                        <button onClick={() => setViewMode('library')} className={`px-8 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${viewMode === 'library' ? 'bg-indigo-600 text-white shadow-xl' : 'bg-white text-slate-400 border'}`}>Resource Library</button>
                                    </div>
                                    {viewMode === 'standards' ? <StandardsView activeTab={activeTab} subTab={subTab} isAdmin={userData?.role === 'ADMIN'} userData={userData} /> : <div>Library View...</div>}
                                </div>
                            ) : (
                                <div className="mesh-bg rounded-[3rem] p-16 text-white shadow-2xl relative animate-in">
                                    <div className="mesh-circle"></div>
                                    <h1 className="text-5xl font-black relative z-10 tracking-tighter">Welcome to the Network</h1>
                                    <p className="mt-4 text-indigo-100 relative z-10 font-bold uppercase text-xs tracking-[0.4em]">Shared YCYW Humanities Excellence</p>
                                </div>
                            )}
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
